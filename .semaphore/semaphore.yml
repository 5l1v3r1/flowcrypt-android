version: v1.0
name: FlowCrypt Android App

agent:
  machine:
    type: e1-standard-4
    os_image: ubuntu1804
  containers:
    - name: main
      image: semaphoreci/android:29

blocks:
  - name: Test without mailserver
    execution_time_limit:
      minutes: 5
    task:
      env_vars:
        - name: SEMAPHORE_GIT_DIR
          value: /home/semaphore/git/flowcrypt-android
      jobs:
        - name: Test without mailserver
          commands:
            - sudo rm -rf ~/.rbenv ~/.phpbrew
            - checkout && cd ~
            - cat /proc/cpuinfo
            - ls ~
            - ls Android
            - ls Android/Sdk



#            # transfer testable result to next block
#            - mkdir ~/testable && mv $SEMAPHORE_GIT_DIR/FlowCrypt/build/outputs/apk/prod/debug/FlowCrypt-prod-debug.apk ~/testable/FlowCrypt-prod-debug.apk
#            - cache store android-testable-$SEMAPHORE_PIPELINE_ID testable

#  - name: Test
#    task:
#      jobs:
#        - name: Find testable folder
#          commands:
#            - cache has_key android-testable-$SEMAPHORE_PIPELINE_ID
#            - cache restore android-testable-$SEMAPHORE_PIPELINE_ID
#            - ls ~/testable/
#            - du -sh ~/testable/*
